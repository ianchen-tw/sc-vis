(this["webpackJsonpsc-vis"]=this["webpackJsonpsc-vis"]||[]).push([[0],{111:function(e,t,n){},112:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(63),c=n.n(i),s=n(17),o=n(67),d=n(10),l=n.n(d),p=n(64),u=n(49),h=n(68),f=n(5),j=n(11),v=n(32),b=n(35),m=n(36),O=n(7),x=n(65),g=n.n(x),y=function e(){Object(j.a)(this,e)};y.NOT_CLOSED="Node not closed",y.CLOSE_VOID="Node close before open",y.DUPLICATED="Node opened twice";var w=function e(){Object(j.a)(this,e)};w.FIELD_MISSING_RUNRECORD="Cannot find property: runRecords in sc-logs",w.FIELD_MISSING_CONFIG="Cannot find property: config in sc-logs",w.RUNRECORD_NOT_ARR="Field: `runRecords` must be an array";var k=new g.a,R=k.compile({optionalProperties:{makeDirectScopeTransparent:{type:"boolean"}}}),C=k.compile({properties:{time:{type:"float64"},name:{type:"string"},desc:{enum:["created","exited"]},type:{enum:["task","scope"]}},optionalProperties:{parent:{type:"string"}}}),E=function(e){Object(v.a)(n,e);var t=Object(b.a)(n);function n(e){var a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Object(j.a)(this,n),(a=t.call(this,e)).hintObject=void 0,a.hintObject=r,a}return n}(Object(m.a)(Error)),N=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},S=function(e){var t=JSON.parse(e);if(!N(t,"config"))return Object(O.a)(new E(w.FIELD_MISSING_CONFIG));if(!N(t,"runRecords"))return Object(O.a)(new E(w.FIELD_MISSING_RUNRECORD));var n=t;if(!Array.isArray(n.runRecords))return Object(O.a)(new E(w.RUNRECORD_NOT_ARR));if(!R(n.config))return Object(O.a)(new E("Failed to parse log config"));var a,r=Object(f.a)(n.runRecords);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(!C(i))return Object(O.a)(new E("Failed to parse runRecord",i))}}catch(s){r.e(s)}finally{r.f()}var c=function(e){var t,n=new Map,a=Object(f.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;if("created"===r.desc){if(n.has(r.name))return Object(O.a)(new E(y.DUPLICATED,r));n.set(r.name,r)}else if("exited"===r.desc){if(!n.has(r.name))return Object(O.a)(new E(y.CLOSE_VOID,r));n.delete(r.name)}}}catch(s){a.e(s)}finally{a.f()}if(n.size>0){var i=[],c=[];if(n.forEach((function(e,t){switch(e.type){case"scope":i.push(e);break;case"task":c.push(e)}})),i.length>0&&console.log("warning: scope not closed",i),c.length>0)return Object(O.a)(new E(y.NOT_CLOSED,Object(h.a)(n)))}return Object(O.b)(!0)}(n.runRecords);return c.err?c:Object(O.b)(t)},_=n(0),T=function(e){var t=e.text;return Object(_.jsx)("div",{className:"font-black text-extralbold text-4xl antialiased",children:Object(_.jsx)("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-blue-500",children:t})})},D=function(e){var t=e.onConfigUpdate,n=e.onRecordsUpdate,r=Object(a.useRef)(null),i=function(){var e=Object(p.a)(l.a.mark((function e(a){var r,i,c,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=S,e.next=3,a.text();case 3:e.t1=e.sent,(r=(0,e.t0)(e.t1)).ok?(i=r.val,c=i.runRecords,s=i.config,n(c),t(s)):(o=r.val,console.log(o),console.log(o.message),void 0!==o.hintObject&&console.log("hint object",o.hintObject));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("button",{type:"button",className:"px-3 text-2xl hover:text-gray-500 flex",onClick:function(){var e;return null===r||void 0===r||null===(e=r.current)||void 0===e?void 0:e.click()},children:Object(_.jsx)(u.a,{})}),Object(_.jsx)("input",{className:"hidden",ref:r,type:"file",onChange:function(e){var t;(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.files)&&i(e.target.files[0])}})]})},I=function(){return Object(_.jsx)("a",{className:"hover:text-gray-500 antialiased px-3 text-2xl flex",target:"_blank",rel:"noreferrer",href:"https://github.com/ianchen-tw/sc-vis",children:Object(_.jsx)(u.b,{})})},F=function(e){var t=e.onRecordsUpdate,n=e.onConfigUpdate;return Object(_.jsx)("header",{className:"pt-5",children:Object(_.jsxs)("div",{className:"max-w-container flex items-center m-2",children:[Object(_.jsx)("div",{className:"flex-none",children:Object(_.jsx)(T,{text:"SC Visualizer"})}),Object(_.jsxs)("div",{className:"flex-grow flex justify-end",children:[Object(_.jsx)(D,{onRecordsUpdate:t,onConfigUpdate:n}),Object(_.jsx)(I,{})]})]})})},A=n(117),U=n(118),L=n(120),P={strokeOpacity:.3},M=function(e){var t=e.width,n=e.height;return Object(_.jsx)("g",{children:Object(_.jsx)("rect",{fill:"None",stroke:"#2460A7FF",strokeWidth:"2",width:t,height:n,style:P})})},V=n(119),B=n(34),G=n(41),z=n(66),J=Object(z.a)("frozen"),H=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;Object(j.a)(this,e),this.name=void 0,this.lifespan=void 0,this.children=void 0,this.parent=void 0,this.type=void 0,Object.defineProperty(this,J,{writable:!0,value:void 0}),this.name=t,this.type=n,this.lifespan={start:a,end:a},this.children=[],this.parent=void 0,Object(G.a)(this,J)[J]=!1,null===r||void 0===r||r.addChildren(this)}return Object(B.a)(e,[{key:"end",value:function(e){this.addEndTime(e),Object(G.a)(this,J)[J]=!0}},{key:"addChildren",value:function(e){if("scope"!==this.type)throw Error("Only scope node can have children");if(!(this.lifespan.start<=e.lifespan.start))throw Error("Cannot add child start earlier than parent,\n                child_start: ".concat(e.lifespan.start,"\n                parent_start: ").concat(this.lifespan.start));this.children.push(e),e.parent=this}},{key:"addEndTime",value:function(e){if(!0===Object(G.a)(this,J)[J])throw Error("Should not modify endtime of a frozen node");if(this.lifespan.end>e)throw Error("Should not shorten the lifespan of nodes");this.lifespan.end=e,this.reportEndTimeToParent()}},{key:"reportEndTimeToParent",value:function(){this.parent&&this.lifespan.end>this.parent.lifespan.end&&this.parent.addEndTime(this.lifespan.end)}}]),e}(),W="__SC_VIS_ROOT_SCOPE__",q=function(e){var t=new H(W,"scope",0,void 0),n=new Map;return n.set(W,t),e.forEach((function(e){if("created"===e.desc){var a,r,i=null!==(a=n.get(null!==(r=e.parent)&&void 0!==r?r:W))&&void 0!==a?a:t,c=new H(e.name,e.type,e.time,i);n.set(c.name,c)}else{if("exited"!==e.desc)throw new Error("unknown desc: ".concat(e));var s;null===(s=n.get(e.name))||void 0===s||s.end(e.time)}})),t},K=function(e){var t,n=e.ticks,a=e.height,r=null!==(t=Object(A.a)(n.map((function(e){return e.pos}))))&&void 0!==t?t:0,i=n.map((function(e){return Object(_.jsxs)("g",{transform:"translate(".concat(e.pos,",0)"),children:[Object(_.jsx)("line",{y2:a,stroke:"black",strokeDasharray:"4, 7",style:{strokeOpacity:.2}}),Object(_.jsx)("text",{style:{textAnchor:"middle"},dy:".71em",y:a+5,children:e.tickValue})]},"tick-".concat(e.tickValue))}));return Object(_.jsxs)(_.Fragment,{children:[i,Object(_.jsx)("text",{dy:".71em",y:a+5,transform:"translate(".concat(r+25,",0)"),children:"Time"})]})},Q={fill:"#C7D3D4FF"},X={fill:"#603F83FF"},Y=function(e){var t=e.width,n=e.outerHeight,a=e.name,r=.9*n,i=.3*n;return Object(_.jsxs)("g",{transform:"translate(0,".concat(i,")"),children:[Object(_.jsx)("rect",{width:t,height:r,style:Q}),Object(_.jsx)("text",{style:X,transform:"translate(5,".concat(.8*n,")"),children:a})]})},Z=20,$=100,ee=20,te=20,ne=function(e){var t,n=e.width,a=void 0===n?600:n,r=e.height,i=void 0===r?400:r,c=function(e,t){var n=Object(V.a)(e);n.sum((function(e){return"task"===e.type?1:0})).sort((function(e,t){return e.data.lifespan.start-t.data.lifespan.start}));var a=[],r=new Map;!function e(n,i){var c;if("task"===n.data.type)throw Error("Should not call this func with task");if(void 0!==n.children){var s=i;n.children.forEach((function(t){var n;switch(t.data.type){case"task":a.push(t.data);break;case"scope":e(t,s)}s+=null!==(n=t.value)&&void 0!==n?n:0}));var o={startRow:i,endRow:i+(null!==(c=n.value)&&void 0!==c?c:0)-1},d=n.data;d.name!==W&&r.set(d,o),t.makeDirectScopeTransparent&&1===d.children.length&&"task"===d.children[0].type&&r.delete(d)}}(n,0);var i=[];return r.forEach((function(e,t){var n=a[e.startRow],r=a[e.endRow];i.push({startTask:n.name,endTask:r.name,scope:t})})),{tasks:a,scopeResults:i}}(e.scopeTree,e.visConfig),s=c.tasks,o=c.scopeResults,d=null!==(t=Object(A.a)(s.map((function(e){var t;return null!==(t=e.lifespan.end)&&void 0!==t?t:0}))))&&void 0!==t?t:0,l=i-Z-ee,p=a-te-$,u=Object(U.a)().domain([0,d]).range([0,p]),h=Object(L.a)().domain(s.map((function(e){return e.name}))).range([0,l]).paddingInner(.5).paddingOuter(.5),f=o.map((function(e){var t,n,a,r=u(e.scope.lifespan.start),i=null!==(t=h(e.startTask))&&void 0!==t?t:0-.2*h.bandwidth(),c=u(e.scope.lifespan.end-e.scope.lifespan.start),s=(null!==(n=h(e.endTask))&&void 0!==n?n:1)-(null!==(a=h(e.startTask))&&void 0!==a?a:0)+1.4*h.bandwidth();return Object(_.jsx)("g",{transform:"translate(".concat(r,",").concat(i,")"),children:Object(_.jsx)(M,{width:c,height:s})})})),j=s.map((function(e){var t,n,a=u(e.lifespan.start),r=null!==(t=h(e.name))&&void 0!==t?t:0,i=u((null!==(n=e.lifespan.end)&&void 0!==n?n:e.lifespan.start)-e.lifespan.start),c=h.bandwidth();return Object(_.jsx)("g",{transform:"translate(".concat(a,",").concat(r,")"),children:Object(_.jsx)(Y,{width:i,outerHeight:c,name:e.name})})})),v=u.ticks().map((function(e){return{tickValue:e,pos:u(e)}}));return Object(_.jsx)("svg",{className:"border-2 border-gray-300",width:a,height:i,viewBox:"0 0 ".concat(a," ").concat(i),children:Object(_.jsxs)("g",{transform:"translate(".concat(te,",").concat(Z,")"),children:[Object(_.jsx)(K,{ticks:v,height:l}),f,j]})})},ae=[{time:0,name:"A",desc:"created",type:"scope",parent:void 0},{time:2,name:"B",desc:"created",type:"scope",parent:"A"},{time:3,name:"t2",desc:"created",type:"task",parent:"B"},{time:4,name:"t2",desc:"exited",type:"task",parent:"B"},{time:6,name:"B",desc:"exited",type:"scope",parent:"A"},{time:1,name:"t1",desc:"created",type:"task",parent:"A"},{time:5,name:"t1",desc:"exited",type:"task",parent:"A"},{time:7,name:"A",desc:"exited",type:"scope",parent:void 0},{time:3.5,name:"C",desc:"created",type:"scope",parent:void 0},{time:5,name:"t3",desc:"created",type:"task",parent:"C"},{time:7,name:"t3",desc:"exited",type:"task",parent:"C"},{time:4,name:"t4",desc:"created",type:"task",parent:"C"},{time:9,name:"t4",desc:"exited",type:"task",parent:"C"},{time:10,name:"C",desc:"exited",type:"scope",parent:void 0}],re={makeDirectScopeTransparent:!1},ie=function(){var e=Object(a.useState)(ae),t=Object(s.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(re),c=Object(s.a)(i,2),d=c[0],l=c[1],p=Object(o.a)(),u=p.ref,h=p.width,f=p.height,j=1*(null!==h&&void 0!==h?h:0),v=.8*(null!==f&&void 0!==f?f:0);return Object(_.jsxs)("div",{className:"container mx-auto px-4 h-screen flex flex-col",children:[Object(_.jsx)("div",{className:"flex-none",children:Object(_.jsx)(F,{onRecordsUpdate:function(e){return r(e)},onConfigUpdate:function(e){return l(e)}})}),Object(_.jsx)("div",{ref:u,className:"h-screen flex-grow justify-center",children:Object(_.jsx)(ne,{scopeTree:q(n),visConfig:d,width:j,height:v})})]})};n(111);c.a.render(Object(_.jsx)(r.a.StrictMode,{children:Object(_.jsx)(ie,{})}),document.getElementById("root"))}},[[112,1,2]]]);
//# sourceMappingURL=main.a9208a72.chunk.js.map